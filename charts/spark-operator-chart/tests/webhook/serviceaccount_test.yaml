suite: Test spark operator webhook service account

templates:
  - webhook/serviceaccount.yaml

release:
  name: spark-operator
  namespace: spark-operator

tests:
  - it: Should not render webhook service account if serviceAccounts.webhook.create is false
    set:
      serviceAccounts:
        webhook:
          create: false
    asserts:
      - hasDocuments:
          count: 0

  - it: Should render webhook service account if serviceAccounts.webhook.create is true and webhook.enable is true
    set:
      webhook:
        enable: true
    asserts:
      - containsDocument:
          apiVersion: v1
          kind: ServiceAccount
          name: spark-operator-webhook

  - it: Should use the specified service account name if serviceAccounts.webhook.name is set
    set:
      serviceAccounts:
        webhook:
          name: custom-service-account
      webhook:
        enable: true
    asserts:
      - containsDocument:
          apiVersion: v1
          kind: ServiceAccount
          name: custom-service-account

  - it: Should add extra annotations if serviceAccounts.webhook.annotations is set
    set:
      serviceAccounts:
        webhook:
          annotations:
            key1: value1
            key2: value2
      webhook:
        enable: true
    asserts:
      - equal:
          path: metadata.annotations.key1
          value: value1
      - equal:
          path: metadata.annotations.key2
          value: value2
